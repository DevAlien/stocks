using GLib;

public class GetApiData {
    public string HttpGet (string ticker, string key) {
        key = "pk_6c967fa2c1154e178644dc481cd95bc4";
        var session = new Soup.Session ();
        var api = "https://cloud.iexapis.com/stable/stock/XOM/quote?token=" + key;

        var message = new Soup.Message (
        "GET",
        api
        );

        message.request_headers.append ("Content-Type", "application/json; charset=utf-8");

        session.send_message (message);

        return (GetCurrentPrice (message));
    }

    private string GetCurrentPrice (Soup.Message msg) {
        var parser = new Json.Parser ();
        parser.load_from_data ( (string) msg.response_body.data);

        var obj = parser.get_root ().get_object ();

        double price_decimal = obj.get_double_member ("latestPrice");
        
        char[] buf = new char [double.DTOSTR_BUF_SIZE];
        string str = price_decimal.to_str (buf);
        
        return (str);
    }
}

/*
things to do
commit to git without api key
round price
find if stock is up or down and by what percentage over last day -> "previousClose": 44.03,and do some maths
store cards locally for state saving
*/
